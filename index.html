<!DOCTYPE html>
<html lang="en">
    <head>
            <meta charset="utf-8">
            <title>Running Total of TMDb Movies by Year</title>
            <style type ="text/css">

            </style>
    </head>

    <body>

        <script src="lib/d3/d3.min.js"></script>
        <script src="lib/d3-dsv/d3-dsv.min.js"></script>
        <script src="lib/d3-fetch/d3-fetch.min.js"></script>


        <script type ="text/javascript">
            // define the dimensions and margins for the graph

            var w = 900
            var h = 900
            var barPadding = 3;
            var padding = 60;




            // define function to parse time in years format

            var parseTime = d3.timeParse("%Y");
        

            // create scales x & y for X and Y axis and set their ranges
            var xScale = d3.scaleTime()
                            .range([padding*2, w-padding]);
            
            var yScale = d3.scaleLinear()
                            .range([h-padding, padding]);
            
            var xAxis = d3.axisBottom()
                            .scale(xScale);

            var yAxis = d3.axisLeft()
                            .scale(yScale);
            

            // append svg element to the body of the page
            // set dimensions and position of the svg element
            var svg = d3.select("body")
                        .append("svg")
                        .attr("width", w)
                        .attr("height", h);


            // Get the data
            var pathToCsv = "q3.csv";		// path to csv
            
            d3.dsv(",", pathToCsv, function (d) {
                    return {
                        year: parseTime(d.year),
                        running_total: parseInt(d.running_total)   
                    }
                        // format data attributes if required
                    
            }).then(function (data) {

                xScale.domain([
                            d3.min(data, function(d) {return d.year}),
                            d3.max(data, function(d) {return d.year})
                        ]);

                yScale.domain([d3.min(data, function(d) {return d.running_total}),
                                d3.max(data, function(d) {return d.running_total})
                                ]);


                svg.selectAll("rect")
                    .data(data)
                    .enter()
                    .append("rect")
                    .attr("x", function(d) {
                        return xScale(d.year);
                    })
                    .attr("y", function(d) {
                        return yScale(d.running_total);
                    })
                    .attr("width", w / data.length - barPadding)
                    .attr("height", function(d) {
                        return h - yScale(d.running_total) - padding;
                    })
                    .attr("fill", "teal");
                

                svg.append("g")
                    .attr("class", "axis")
                    .attr("transform", "translate(0," + (h - padding) + ")")
                    .call(xAxis)
                
                svg.append("g")
                    .attr("class", "axis")
                    .attr("transform", "translate(" + padding*2 + ",0)")
                    .call(yAxis);

                svg.append("text")      // text label for the x axis
                    .attr("x", w/2)
                    .attr("y", h - padding/4 )
                    .style("text-anchor", "middle")
                    .text("Date");

                svg.append("text")
                    .attr("class", "y label")
                    .attr("text-anchor", "middle")
                    .attr("y", padding/2)
                    .attr("x", 0 - w /2)
                    //.attr("dy", "1em")
                    .attr("transform", "rotate(-90)")
                    .text("Running Total");

                console.log(data); // you should see the data in your browser's developer tools console 
                }).catch(function (error) {
                    console.log(error);
                    });
                
        </script>
    </body>
</html>
